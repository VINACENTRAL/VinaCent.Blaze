@using Abp.Collections.Extensions
@using VinaCent.Blaze.BusinessCore.ShopModule.Categories.Dto
@using VinaCent.Blaze.Web.Models.Common.Modals
@model VinaCent.Blaze.BusinessCore.ShopModule.Categories.Dto.UpdateCategoryDto
@{
    Layout = null;
    var currentLevel = Model.Level;
    var title = currentLevel == 0 ? L(LKConstants.ShopModule_UpdateParentCategory) : L(LKConstants.ShopModule_UpdateChildCategory);

    var languageInfos = LanguageManager.GetActiveLanguages();
    if (Model.Translations.IsNullOrEmpty())
    {
        Model.Translations = languageInfos.Select(x => new CategoryTranslationDto(x.Name)).ToList();
    }
    else
    {
        var names = Model.Translations.Select(x => x.Language).ToArray();
        Model.Translations.AddRange(languageInfos.Where(x => !names.Any(n => n == x.Name)).Select(x => new CategoryTranslationDto(x.Name)));
    }
}
@await Html.PartialAsync("~/Views/Shared/Modals/_ModalHeader.cshtml", new ModalHeaderViewModel(title))
<form id="UpdateForm" role="form" class="form-horizontal">
    <div class="modal-body">
        @if (currentLevel != 0)
        {
            <div class="required mb-3">
                <label class="form-label" asp-for="ParentId"></label>
                <select class="form-control" asp-for="ParentId" asp-items="@ViewBag.Parents"></select>
                <span asp-validation-for="ParentId" class="invalid-feedback"></span>
            </div>
        }
        <div class="required mb-3">
            <label class="form-label" asp-for="Slug"></label>
            <input type="text" asp-for="Slug" class="form-control" />
            <span asp-validation-for="Slug" class="invalid-feedback"></span>
        </div>
        <div class="form-check form-switch form-switch-success mb-3">
            <input class="form-check-input" type="checkbox" role="switch" asp-for="IsActive" value="true">
            <label class="form-check-label" asp-for="IsActive"></label>
            <span asp-validation-for="IsActive" class="invalid-feedback"></span>
        </div>

        <ul class="nav nav-tabs nav-justified nav-border-top nav-border-top-success mb-3" role="tablist">
            @foreach (var translation in Model.Translations)
            {
                var languageInfo = languageInfos.FirstOrDefault(x => x.Name.Equals(translation.Language));
                <li class="nav-item">
                    <a class="nav-link @(languageInfo.Name == languageInfos.FirstOrDefault()?.Name?"active":"")" data-bs-toggle="tab" href="#update-@translation.Language" role="tab" aria-selected="false">
                        <img src="/vinacent/flags/1x1/@languageInfo.Icon" alt="user-image" class="me-2 rounded" height="18" /> @languageInfo.DisplayName
                    </a>
                </li>
            }
        </ul>
        <div class="tab-content text-muted">
            @for (int i = 0; i < Model.Translations.Count; i++)
            {
                var languageInfo = languageInfos.FirstOrDefault(x => x.Name.Equals(Model.Translations[i].Language));
                <div class="tab-pane @(languageInfo.Name == languageInfos.FirstOrDefault()?.Name?"active":"")" id="update-@Model.Translations[i].Language" role="tabpanel">
                    <input type="hidden" asp-for="Translations[i].Language" />
                    <div class="required mb-3">
                        <label class="form-label d-flex" asp-for="Translations[i].Title">@L(LKConstants.Title) <span class="small ms-auto text-info">[@languageInfo.Name]</span></label>
                        <input type="text" asp-for="Translations[i].Title" class="form-control" />
                        <span asp-validation-for="Translations[i].Title" class="invalid-feedback"></span>
                    </div>
                    <div class="required mb-3">
                        <label class="form-label d-flex" asp-for="Translations[i].MetaTitle">@L(LKConstants.MetaTitle) <span class="small ms-auto text-info">[@languageInfo.Name]</span></label>
                        <input type="text" asp-for="Translations[i].MetaTitle" class="form-control" />
                        <span asp-validation-for="Translations[i].MetaTitle" class="invalid-feedback"></span>
                    </div>
                    <div class="required mb-3">
                        <label class="form-label d-flex" asp-for="Translations[i].Content">@L(LKConstants.Content) <span class="small ms-auto text-info">[@languageInfo.Name]</span></label>
                        <textarea class="form-control" asp-for="Translations[i].Content"></textarea>
                        <span asp-validation-for="Translations[i].Content" class="invalid-feedback"></span>
                    </div>
                </div>
            }
        </div>
    </div>
    @await Html.PartialAsync("~/Views/Shared/Modals/_ModalFooterWithSaveAndCancel.cshtml")
</form>